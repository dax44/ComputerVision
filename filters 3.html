<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pl" xml:lang="pl">

<head>

<meta charset="utf-8" />
<meta name="generator" content="quarto-1.2.269" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />


<title>Automatyczna analiza obrazu – 6  Filtry</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<!-- htmldependencies:E3FAD763 -->
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Brak wyników",
    "search-matching-documents-text": "dopasowane dokumenty",
    "search-copy-link-title": "Kopiuj link do wyszukiwania",
    "search-hide-matches-text": "Ukryj dodatkowe dopasowania",
    "search-more-match-text": "więcej dopasowań w tym dokumencie",
    "search-more-matches-text": "więcej dopasowań w tym dokumencie",
    "search-clear-button-title": "Wyczyść",
    "search-detached-cancel-button-title": "Anuluj",
    "search-submit-button-title": "Zatwierdź"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" 
        data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" 
        aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation"
        onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"
  >
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"></h1>
      <button type="button" 
        class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="/index.html" class="sidebar-logo-link">
      <img src="/images/logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none"/>
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="/">
      Automatyczna analiza obrazu
      </a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://twitter.com" title="" class="sidebar-tool px-1"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/dax44/ComputerVision/" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="Download" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-download"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="/Automatyczna-analiza-obrazu.pdf">
            <i class="bi bi-bi-file-pdf pe-1"></i>
          Download PDF
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="/Automatyczna-analiza-obrazu.epub">
            <i class="bi bi-bi-journal pe-1"></i>
          Download ePub
          </a>
        </li>
    </ul>
    <a href="https://twitter.com/intent/tweet?url=|url|" title="Twitter" class="sidebar-tool px-1"><i class="bi bi-twitter"></i></a>
  <a href="" class="quarto-color-scheme-toggle sidebar-tool" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle sidebar-tool" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/index.html" class="sidebar-item-text sidebar-link">Wstęp</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/intro.html" class="sidebar-item-text sidebar-link"><span class='chapter-number'>1</span>  <span class='chapter-title'>Wprowadzenie</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/history.html" class="sidebar-item-text sidebar-link"><span class='chapter-number'>2</span>  <span class='chapter-title'>Historia wizji komputerowej</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/digt_img.html" class="sidebar-item-text sidebar-link"><span class='chapter-number'>3</span>  <span class='chapter-title'>Obrazy cyfrowe</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/transformations.html" class="sidebar-item-text sidebar-link"><span class='chapter-number'>4</span>  <span class='chapter-title'>Transformacje geometryczne</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/point_trans.html" class="sidebar-item-text sidebar-link"><span class='chapter-number'>5</span>  <span class='chapter-title'>Transformacje punktowe</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/filters.html" class="sidebar-item-text sidebar-link active"><span class='chapter-number'>6</span>  <span class='chapter-title'>Filtry</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/references.html" class="sidebar-item-text sidebar-link">Bibliografia</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <div id="quarto-toc-target"></div>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">6</span>  <span class="chapter-title">Filtry</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>
<nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Spis treści</h2>
   
  <ul>
  <li><a href="#filtry-liniowe" id="toc-filtry-liniowe"><span class="toc-section-number">6.1</span> <span class="header-section-number">6.1</span> Filtry liniowe</a>
  <ul>
  <li><a href="#przykładowe-filtry-wygładzające-ang.-smoothing" id="toc-przykładowe-filtry-wygładzające-ang.-smoothing"><span class="toc-section-number">6.1.1</span> <span class="header-section-number">6.1.1</span> Przykładowe filtry wygładzające (ang. <em>smoothing</em>)</a></li>
  <li><a href="#przykład-filtru-różnicującego" id="toc-przykład-filtru-różnicującego"><span class="toc-section-number">6.1.2</span> <span class="header-section-number">6.1.2</span> Przykład filtru różnicującego</a></li>
  </ul></li>
  </ul>
</nav>
<p>Zasadniczą własnością operacji punktowych (omówionych w poprzednim rozdziale) jest to, że każda nowa wartość piksela zależy tylko od oryginalnego piksela w tej samej pozycji. Możliwości operacji punktowych są jednak ograniczone. Nie mogą one na przykład zrealizować zadania wyostrzenia lub wygładzenia obrazu (patrz <a href="#fig-flt1">Rysunek <span class="quarto-unresolved-ref">fig-flt1</span></a>). Taką funkcję mogą spełniać filtry. Są one podobne do operacji punktowych w tym sensie, że również tworzą odwzorowanie 1:1 współrzędnych obrazu, czyli geometria obrazu nie ulega zmianie.</p>
<div class="cell">
<details>
<summary>Kod</summary>
<div class="sourceCode" id="cb1"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(imager)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_il</span>(<span class="sc">~</span><span class="fu">boxblur</span>(boats, .x)) <span class="sc">|&gt;</span> </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">imappend</span>(<span class="st">&quot;x&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-flt1" class="quarto-figure quarto-figure-center">
<figure>
<p><img src="filters_files/figure-html/fig-flt1-1.png" class="img-fluid" width="672" /></p>
<p><figcaption>Rysunek 6.1: Zastosowanie filtrów rozmycia obrazu. Pierwszy obraz jest bez rozmycia, drugi z filtrem o wielkości 3x3, a ostatni z filtrem 5x5.</figcaption></p>
</figure>
</div>
</div>
</div>
<p>Zastosowany powyżej filtr rozmycia obrazu jest jednym z filtrów liniowych, który działa jak swego rodzaju uśrednienie pikseli w lokalnym otoczeniu. Otoczenie to oczywiście się przesuwa po całym obrazie tworząc obraz przefiltrowany. Chcąc nieco bardziej formalnie przedstawić operację filtracji musimy podzielić filtry na liniowe i nieliniowe.</p>
<section id="filtry-liniowe" class="level2" data-number="6.1">
<h2 data-number="6.1"><span class="header-section-number">6.1</span> Filtry liniowe</h2>
<p>Filtry liniowe są nazywane w ten sposób, ponieważ łączą wartości pikseli w otoczeniu w sposób liniowy, czyli jako suma ważona. Szczególnym przykładem jest omówiony na początku proces uśredniania lokalnego (<a href="#eq-1">Równanie <span class="quarto-unresolved-ref">eq-1</span></a>), gdzie wszystkie dziewięć pikseli w lokalnym otoczeniu 3 × 3 jest dodawanych z identycznymi wagami (1/9). Dzięki temu samemu mechanizmowi można zdefiniować mnóstwo filtrów o różnych właściwościach, modyfikując po prostu rozkład poszczególnych wag.</p>
<p><span id="eq-1"><span class="math display">\[
I&#39;(u,v) = \frac19\sum_{j = -1}^1\sum_{i = -1}^1I(u+i,v+j),
\tag{6.1}\]</span></span></p>
<p>Dla dowolnego filtra liniowego rozmiar i kształt regionu wsparcia (ang. <em>support region</em>), jak również wagi poszczególnych pikseli, są określone przez <em>jądro filtra</em> (ang. <em>kernel</em>) <span class="math inline">\(H(i,j)\)</span>. Rozmiar jądra <span class="math inline">\(H\)</span> równa się rozmiarowi regionu filtrującego, a każdy element <span class="math inline">\((i, j)\)</span> określa wagę odpowiedniego piksela w sumowaniu. Dla filtra wygładzającego 3x3 w równaniu (<a href="#eq-1">Równanie <span class="quarto-unresolved-ref">eq-1</span></a>), jądro filtra to</p>
<p><span class="math display">\[
H = \begin{bmatrix}
  1/9,&amp;1/9,&amp;1/9\\
  1/9,&amp;1/9,&amp;1/9\\
  1/9,&amp;1/9,&amp;1/9
\end{bmatrix}=
\frac19\begin{bmatrix}
  1,&amp;1,&amp;1\\
  1,&amp;1,&amp;1\\
  1,&amp;1,&amp;1
\end{bmatrix}
\]</span></p>
<p>ponieważ każda z wartości filtra wnosi 1/9 do piksela wynikowego.</p>
<p>W istocie, jądro filtra <span class="math inline">\(H(i, j)\)</span> jest, podobnie jak sam obraz, dyskretną, dwuwymiarową funkcją o rzeczywistą, <span class="math inline">\(H : \mathbb{Z} \times \mathbb{Z} \to \mathbb{R}\)</span>. Filtr ma swój własny układ współrzędnych z początkiem - często określanym jako <em>hot spot</em> - przeważnie (ale niekoniecznie) znajdującym się w środku. Tak więc współrzędne filtra są na ogół dodatnie i ujemne (<a href="#fig-flt2">Rysunek <span class="quarto-unresolved-ref">fig-flt2</span></a>). Funkcja filtra ma nieskończony zakres i jest uważana za zerową poza obszarem zdefiniowanym przez macierz <span class="math inline">\(H\)</span>.</p>
<div id="fig-flt2" class="quarto-figure quarto-figure-center">
<figure>
<p><img src="images/Zrzut%20ekranu%202023-02-7%20o%2021.37.50.png" class="img-fluid" /></p>
<p><figcaption>Rysunek 6.2: Schemat działania filtru</figcaption></p>
</figure>
</div>
<p>Dla filtru liniowego wynik jest jednoznacznie i całkowicie określony przez współczynniki jądra filtru. Zastosowanie filtru do obrazu jest prostym procesem, który został zilustrowany na <a href="#fig-flt2">Rysunek <span class="quarto-unresolved-ref">fig-flt2</span></a>. W każdej pozycji obrazu <span class="math inline">\((u, v)\)</span> wykonywane są następujące kroki:</p>
<ol type="1">
<li>Jądro filtra <span class="math inline">\(H\)</span> jest przesuwane nad oryginalnym obrazem <span class="math inline">\(I\)</span> tak, że jego początek <span class="math inline">\(H(0, 0)\)</span> pokrywa się z aktualną pozycją obrazu <span class="math inline">\((u, v)\)</span>.</li>
<li>Wszystkie współczynniki filtra <span class="math inline">\(H(i, j)\)</span> są mnożone z odpowiadającym im elementem obrazu <span class="math inline">\(I(u+i,v+j)\)</span>, a wyniki są sumowane.</li>
<li>Na koniec otrzymana suma jest zapisywana w aktualnej pozycji w nowym obrazie <span class="math inline">\(I&#39;(u, v)\)</span>.</li>
</ol>
<p>Opisując formalnie, wartości pikseli nowego obrazu <span class="math inline">\(I&#39;(u,v)\)</span> są obliczane przez operację</p>
<p><span id="eq-filtr"><span class="math display">\[
I&#39;(u,v) = \sum_{i,j\in R_H}I(u+i, v+j)\cdot H(i,j),
\tag{6.2}\]</span></span></p>
<p>gdzie <span class="math inline">\(R_H\)</span> oznacza zbiór współrzędnych pokrytych przez filtr <span class="math inline">\(H\)</span>. Nie całkiem dla wszystkich współrzędnych, aby być dokładnym. Istnieje oczywisty problem na granicach obrazu, gdzie filtr sięga poza obraz i nie znajduje odpowiadających mu wartości pikseli, które mógłby wykorzystać do obliczenia wyniku. Na razie ignorujemy ten problem granic, ale w dalszej części tego wykładu się tym zajmiemy.</p>
<div id="fig-flt3" class="quarto-figure quarto-figure-center">
<figure>
<p><img src="images/2D_Convolution_Animation.gif" class="img-fluid" /></p>
<p><figcaption>Rysunek 6.3: Ilustracja działania filtru</figcaption></p>
</figure>
</div>
<p>Skoro rozumiemy już zasadnicze działanie filtrów i wiemy, że granice wymagają szczególnej uwagi, możemy pójść dalej i zaprogramować prosty filtr liniowy. Zanim jednak to zrobimy, możemy chcieć rozważyć jeszcze jeden szczegół. W operacji punktowej każda nowa wartość piksela zależy tylko od odpowiadającej jej wartości piksela w oryginalnym obrazie, dlatego nie było problemu z zapisaniem wyników z powrotem do tego samego obrazu - obliczenia są wykonywane “w locie” bez potrzeby pośredniego przechowywania. Obliczenia w miejscu nie są generalnie możliwe dla filtra, ponieważ każdy oryginalny piksel przyczynia się do zmiany więcej niż jednego piksela wynikowego i dlatego nie może być zmodyfikowany przed zakończeniem wszystkich operacji.</p>
<p>Potrzebujemy zatem dodatkowego miejsca na przechowywanie obrazu wynikowego, który następnie może być ponownie skopiowany do obrazu źródłowego (jeśli jest to pożądane). Tak więc kompletna operacja filtrowania może być zaimplementowana na dwa różne sposoby (<a href="#fig-flt4">Rysunek <span class="quarto-unresolved-ref">fig-flt4</span></a>):</p>
<ol type="A">
<li>Wynik obliczeń filtra jest początkowo zapisywany w nowym obrazie, którego zawartość jest ostatecznie zapisywana z powrotem do obrazu oryginalnego.</li>
<li>Oryginalny obraz jest najpierw kopiowany do obrazu pośredniego, który służy jako źródło dla właściwej operacji filtrowania. Wynik zastępuje piksele w oryginalnym obrazie.</li>
</ol>
<div id="fig-flt4" class="quarto-figure quarto-figure-center">
<figure>
<p><img src="images/Zrzut%20ekranu%202023-02-7%20o%2022.10.38.png" class="img-fluid" /></p>
<p><figcaption>Rysunek 6.4: Dwa schematy implementacji filtrów do obrazów</figcaption></p>
</figure>
</div>
<p>Dla obu wersji wymagana jest taka sama ilość pamięci masowej, a więc żadna z nich nie oferuje szczególnej przewagi. W poniższych przykładach używamy na ogół wersji B.</p>
<p>W filtrze prezentowanym powyżej wagi nie muszą być wszystkie takie same. Przykładowo filtr <span class="math inline">\(H(u,v)\)</span> określony następująco</p>
<p><span id="eq-gaussian"><span class="math display">\[
H(u,v)=\begin{bmatrix}
  0.075,&amp;0.125,&amp;0.075\\
  0.125,&amp;0.200,&amp;0.125\\
  0.075,&amp;0.125,&amp;0.075
\end{bmatrix}
\tag{6.3}\]</span></span></p>
<p>również uśrednia wartości w regionie wsparcia filtru ale nadając największe wagi wartościom w środku.</p>
<p>Zauważmy, że wagi filtra <span class="math inline">\(H\)</span> są tak dobrane aby się sumowały do 1. Oznacza to, że filtr ten jest znormalizowany. Normalizacji filtrów używa się po to aby uniknąć sytuacji, w której wartość wyjściowa z filtra byłaby większa niż 255.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class='callout-icon'></i>
</div>
<div class="callout-caption-container flex-fill">
Wskazówka
</div>
</div>
<div class="callout-body-container callout-body">
<p>Ponieważ funkcja <code>plot</code> pakietu <code>imager</code> ma włączoną opcję <code>rescale = TRUE</code> co oznacza, że wartości wynikowe i tak będą przekształcone do przedziału [0,1], to nie unormowane filtry i tak będą wyświetlać poprawnie przefiltrowane obrazy.</p>
</div>
</div>
<div class="cell">
<details>
<summary>Kod</summary>
<div class="sourceCode" id="cb2"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>filter1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                   <span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                   <span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>), </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>filter1</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]    1    1    1
[2,]    1    1    1
[3,]    1    1    1</code></pre>
</div>
<details>
<summary>Kod</summary>
<div class="sourceCode" id="cb4"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>filter2 <span class="ot">&lt;-</span> filter1<span class="sc">/</span><span class="dv">9</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>filter2 <span class="sc">|&gt;</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fractions</span>() <span class="co"># aby ładnie wyświetlić ułamki</span></span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,] 1/9  1/9  1/9 
[2,] 1/9  1/9  1/9 
[3,] 1/9  1/9  1/9 </code></pre>
</div>
<details>
<summary>Kod</summary>
<div class="sourceCode" id="cb6"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># filtry w funkcji convolve muszą być zapisane jako obraz (as.cimg)</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">layout</span>(<span class="fu">t</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">convolve</span>(boats, <span class="fu">as.cimg</span>(filter1)) <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">convolve</span>(boats, <span class="fu">as.cimg</span>(filter2)) <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-rescale" class="quarto-figure quarto-figure-center">
<figure>
<p><img src="filters_files/figure-html/fig-rescale-1.png" class="img-fluid" width="672" /></p>
<p><figcaption>Rysunek 6.5: Przykład użycia filtra przed i po normalizacji</figcaption></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Kod</summary>
<div class="sourceCode" id="cb7"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">convolve</span>(boats, <span class="fu">as.cimg</span>(filter1)) <span class="sc">|&gt;</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">rescale =</span> <span class="cn">FALSE</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Error in colourscale(v[[1]], v[[2]], v[[3]]) : 
  color intensity 1.57913, not in [0,1]</code></pre>
</div>
</div>
<p>Zatem możemy w konstruowaniu filtrów stosować wartości całkowite i wspólnej wartości normalizacyjnej.</p>
<p><span class="math display">\[
H(u,v)=\begin{bmatrix}
  0.075,&amp;0.125,&amp;0.075\\
  0.125,&amp;0.200,&amp;0.125\\
  0.075,&amp;0.125,&amp;0.075
\end{bmatrix}=
\frac1{40}\cdot
\begin{bmatrix}
  3,&amp;5,&amp;3\\
  5,&amp;8,&amp;5\\
  3,&amp;5,&amp;3
\end{bmatrix}.
\]</span> Aby uniknąć wartości ujemnych, które mogłyby się pojawić w przypadku gdy jądro filtra zawierałoby wartości ujemne, stosuje się stałą przesunięcia (ang. <em>offset</em>). Wówczas <a href="#eq-filtr">Równanie <span class="quarto-unresolved-ref">eq-filtr</span></a> przyjmuje postać</p>
<p><span class="math display">\[
I&#39;(u,v) = Offset+\frac{1}{Scale}\cdot \sum_{i,j\in R_H}I(u+i, v+j)\cdot H(i,j),
\]</span> a <span class="math inline">\(H(i,j)\)</span> jest zdefiniowany na <span class="math inline">\(\mathbb{Z}\times\mathbb{Z}\)</span>. Chociaż najczęściej używa się filtrów kwadratowych, to nie ma przeszkód aby stosować również filtry prostokątne. Powyższa formuła ma zastosowanie do filtrów o dowolnym rozmiarze i kształcie.</p>
<section id="przykładowe-filtry-wygładzające-ang.-smoothing" class="level3" data-number="6.1.1">
<h3 data-number="6.1.1"><span class="header-section-number">6.1.1</span> Przykładowe filtry wygładzające (ang. <em>smoothing</em>)</h3>
<ol type="1">
<li><p>Filtr pudełkowy (ang <em>box</em>), którego zasada działania została już przedstawiona w <a href="#eq-1">Równanie <span class="quarto-unresolved-ref">eq-1</span></a> dla rozmiaru filtra 3x3 jest jednym z filtrów wygładzających. Im większy jest rozmiar filtra, tym większy stopień wygładzenia obrazu wyjściowego. Ten najprostszy ze wszystkich filtrów wygładzających, którego kształt 3D przypomina pudełko (rys. 5.8(a)), jest dobrze znany. Niestety, filtr pudełkowy jest daleki od optymalnego filtra wygładzającego ze względu na swoje dziwne zachowanie w przestrzeni częstotliwości, które jest spowodowane ostrym odcięciem wokół jego boków. Opisane w kategoriach częstotliwościowych wygładzanie odpowiada tzw. filtracji dolnoprzepustowej, czyli efektywnemu tłumieniu wszystkich składowych sygnału powyżej danej częstotliwości odcięcia. Filtr pudełkowy wytwarza jednak silne “dzwonienie” w przestrzeni częstotliwości i dlatego nie jest uważany za wysokiej jakości filtr wygładzający. Przypisanie tej samej wagi wszystkim pikselom obrazu w regionie filtru może też wydawać się dość doraźne. Zamiast tego należałoby prawdopodobnie oczekiwać, że silniejszy nacisk zostanie położony na piksele znajdujące się w pobliżu centrum filtra niż na te bardziej odległe. Ponadto filtry wygładzające powinny ewentualnie działać “izotropowo” (tzn. jednolicie w każdym kierunku), co z pewnością nie ma miejsca w przypadku filtra prostokątnego.</p></li>
<li><p>Filtr gaussowski - z pewnością lepszy w tym kontekście wygładzania z względu na brak ostrych krawędzi jądra. Definiuje się go następująco</p></li>
</ol>
<p><span class="math display">\[
H^{G,\sigma}(x,y) = e^{-\frac{x^2+y^2}{2\sigma^2}},
\]</span> gdzie <span class="math inline">\(\sigma\)</span> oznacza odchylenie standardowe rozkładu.</p>
</section>
<section id="przykład-filtru-różnicującego" class="level3" data-number="6.1.2">
<h3 data-number="6.1.2"><span class="header-section-number">6.1.2</span> Przykład filtru różnicującego</h3>
<p>Jeśli niektóre współczynniki filtra są ujemne, to obliczenie filtra można zinterpretować jako różnicę dwóch sum: suma ważona wszystkich pikseli z przypisanymi współczynnikami dodatnimi minus suma ważona pikseli z ujemnymi współczynnikami w regionie filtra RH , czyli</p>
<p><span class="math display">\[
I&#39;(u,v)=\sum_{(i,j)\in R^+}
\]</span></p>
<div id="quarto-navigation-envelope" class="hidden">
<p><span class="hidden" data-render-id="quarto-int-sidebar-title">Automatyczna analiza obrazu</span> <span class="hidden" data-render-id="quarto-int-navbar-title">Automatyczna analiza obrazu</span> <span class="hidden" data-render-id="quarto-int-next">Bibliografia</span> <span class="hidden" data-render-id="quarto-int-prev"><span class="chapter-number">5</span>  <span class="chapter-title">Transformacje punktowe</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/index.html">Wstęp</span> <span class="hidden" data-render-id="quarto-int-sidebar:/intro.html"><span class="chapter-number">1</span>  <span class="chapter-title">Wprowadzenie</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/history.html"><span class="chapter-number">2</span>  <span class="chapter-title">Historia wizji komputerowej</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/digt_img.html"><span class="chapter-number">3</span>  <span class="chapter-title">Obrazy cyfrowe</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/transformations.html"><span class="chapter-number">4</span>  <span class="chapter-title">Transformacje geometryczne</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/point_trans.html"><span class="chapter-number">5</span>  <span class="chapter-title">Transformacje punktowe</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/filters.html"><span class="chapter-number">6</span>  <span class="chapter-title">Filtry</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/references.html">Bibliografia</span> <span class="hidden" data-render-id="footer-left">Automatyczna analiza obrazu, Dariusz Majerek</span> <span class="hidden" data-render-id="footer-right">Książka została napisana w <a href="https://quarto.org/">Quarto</a></span></p>
</div>
<div id="quarto-meta-markdown" class="hidden">
<p><span class="hidden" data-render-id="quarto-metatitle">Automatyczna analiza obrazu - <span class="chapter-number">6</span>  <span class="chapter-title">Filtry</span></span> <span class="hidden" data-render-id="quarto-twittercardtitle">Automatyczna analiza obrazu - <span class="chapter-number">6</span>  <span class="chapter-title">Filtry</span></span> <span class="hidden" data-render-id="quarto-ogcardtitle">Automatyczna analiza obrazu - <span class="chapter-number">6</span>  <span class="chapter-title">Filtry</span></span> <span class="hidden" data-render-id="quarto-metasitename">Automatyczna analiza obrazu</span></p>
</div>
</section>
</section>

</main> <!-- /main -->
<script id = "quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Skopiowano!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Skopiowano!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a  href="/point_trans.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class='chapter-number'>5</span>  <span class='chapter-title'>Transformacje punktowe</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a  href="/references.html" class="pagination-link">
        <span class="nav-page-text">Bibliografia</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <div class='footer-contents'>Automatyczna analiza obrazu, Dariusz Majerek
</div>  
    </div>   
    <div class="nav-footer-right">
      <div class='footer-contents'>Książka została napisana w <a href="https://quarto.org/">Quarto</a>
</div>  
    </div>
  </div>
</footer>

</body>

</html>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pl" xml:lang="pl"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.203">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Automatyczna analiza obrazu - 6&nbsp; Filtry</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./edge.html" rel="next">
<link href="./point_trans.html" rel="prev">
<link href="./cover.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Brak wyników",
    "search-matching-documents-text": "dopasowane dokumenty",
    "search-copy-link-title": "Kopiuj link do wyszukiwania",
    "search-hide-matches-text": "Ukryj dodatkowe dopasowania",
    "search-more-match-text": "więcej dopasowań w tym dokumencie",
    "search-more-matches-text": "więcej dopasowań w tym dokumencie",
    "search-clear-button-title": "Wyczyść",
    "search-detached-cancel-button-title": "Anuluj",
    "search-submit-button-title": "Zatwierdź"
  }
}</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./filters.html">&lt;span class='chapter-number'&gt;6&lt;/span&gt;&nbsp; &lt;span class='chapter-title'&gt;Filtry&lt;/span&gt;</a></li></ol></nav>
      <a class="flex-grow-1" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
      </a>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./images/logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none"></a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Automatyczna analiza obrazu</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://twitter.com" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/dax44/ComputerVision/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="https://twitter.com/intent/tweet?url=%7Curl%7C" title="Twitter" class="quarto-navigation-tool px-1" aria-label="Twitter"><i class="bi bi-twitter"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Wstęp</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Wprowadzenie</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./history.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Historia wizji komputerowej</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./digt_img.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Obrazy cyfrowe</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./transformations.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Transformacje geometryczne</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./point_trans.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Transformacje punktowe</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./filters.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Filtry</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./edge.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Wykrywanie krawędzi i konturów</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./morpho.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Filtry morfologiczne</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">Bibliografia</a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Spis treści</h2>
   
  <ul>
<li>
<a href="#filtry-liniowe" id="toc-filtry-liniowe" class="nav-link active" data-scroll-target="#filtry-liniowe"><span class="toc-section-number">6.1</span>  Filtry liniowe</a>
  <ul class="collapse">
<li><a href="#przyk%C5%82adowe-filtry-wyg%C5%82adzaj%C4%85ce-ang.-smoothing" id="toc-przykładowe-filtry-wygładzające-ang.-smoothing" class="nav-link" data-scroll-target="#przyk%C5%82adowe-filtry-wyg%C5%82adzaj%C4%85ce-ang.-smoothing"><span class="toc-section-number">6.1.1</span>  Przykładowe filtry wygładzające (ang. <em>smoothing</em>)</a></li>
  <li><a href="#przyk%C5%82ad-filtru-r%C3%B3%C5%BCnicuj%C4%85cego" id="toc-przykład-filtru-różnicującego" class="nav-link" data-scroll-target="#przyk%C5%82ad-filtru-r%C3%B3%C5%BCnicuj%C4%85cego"><span class="toc-section-number">6.1.2</span>  Przykład filtru różnicującego</a></li>
  <li><a href="#formalny-zapis-operator%C3%B3w-filtracji" id="toc-formalny-zapis-operatorów-filtracji" class="nav-link" data-scroll-target="#formalny-zapis-operator%C3%B3w-filtracji"><span class="toc-section-number">6.1.3</span>  Formalny zapis operatorów filtracji</a></li>
  <li><a href="#w%C5%82asno%C5%9Bci-filtr%C3%B3w-liniowych" id="toc-własności-filtrów-liniowych" class="nav-link" data-scroll-target="#w%C5%82asno%C5%9Bci-filtr%C3%B3w-liniowych"><span class="toc-section-number">6.1.4</span>  Własności filtrów liniowych</a></li>
  </ul>
</li>
  <li>
<a href="#filtry-nieliniowe" id="toc-filtry-nieliniowe" class="nav-link" data-scroll-target="#filtry-nieliniowe"><span class="toc-section-number">6.2</span>  Filtry nieliniowe</a>
  <ul class="collapse">
<li><a href="#filtry-minimum-i-maksimum" id="toc-filtry-minimum-i-maksimum" class="nav-link" data-scroll-target="#filtry-minimum-i-maksimum"><span class="toc-section-number">6.2.1</span>  Filtry minimum i maksimum</a></li>
  <li><a href="#filtr-medianowy" id="toc-filtr-medianowy" class="nav-link" data-scroll-target="#filtr-medianowy"><span class="toc-section-number">6.2.2</span>  Filtr medianowy</a></li>
  </ul>
</li>
  <li><a href="#obramowania-obraz%C3%B3w" id="toc-obramowania-obrazów" class="nav-link" data-scroll-target="#obramowania-obraz%C3%B3w"><span class="toc-section-number">6.3</span>  Obramowania obrazów</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/dax44/ComputerVision/issues/new" class="toc-action">Zgłoś problem</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">
<span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Filtry</span>
</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p>Zasadniczą własnością operacji punktowych (omówionych w poprzednim rozdziale) jest to, że każda nowa wartość piksela zależy tylko od oryginalnego piksela w tej samej pozycji. Możliwości operacji punktowych są jednak ograniczone. Nie mogą one na przykład zrealizować zadania wyostrzenia lub wygładzenia obrazu (patrz <a href="#fig-flt1">Rysunek&nbsp;<span>6.1</span></a>). Taką funkcję mogą spełniać filtry. Są one podobne do operacji punktowych w tym sensie, że również tworzą odwzorowanie 1:1 współrzędnych obrazu, czyli geometria obrazu nie ulega zmianie.</p>
<div class="cell">
<details><summary>Kod</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://dahtah.github.io/imager/">imager</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/imager/man/map_il.html">map_il</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/imager/man/boxblur.html">boxblur</a></span><span class="op">(</span><span class="va">boats</span>, <span class="va">.x</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/imager/man/imappend.html">imappend</a></span><span class="op">(</span><span class="st">"x"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-flt1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="filters_files/figure-html/fig-flt1-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Rysunek&nbsp;6.1: Zastosowanie filtrów rozmycia obrazu. Pierwszy obraz jest bez rozmycia, drugi z filtrem o wielkości 3x3, a ostatni z filtrem 5x5.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Zastosowany powyżej filtr rozmycia obrazu jest jednym z filtrów liniowych, który działa jak swego rodzaju uśrednienie pikseli w lokalnym otoczeniu. Otoczenie to oczywiście się przesuwa po całym obrazie tworząc obraz przefiltrowany. Chcąc nieco bardziej formalnie przedstawić operację filtracji musimy podzielić filtry na liniowe i nieliniowe.</p>
<section id="filtry-liniowe" class="level2" data-number="6.1"><h2 data-number="6.1" class="anchored" data-anchor-id="filtry-liniowe">
<span class="header-section-number">6.1</span> Filtry liniowe</h2>
<p>Filtry liniowe są nazywane w ten sposób, ponieważ łączą wartości pikseli w otoczeniu w sposób liniowy, czyli jako suma ważona. Szczególnym przykładem jest omówiony na początku proces uśredniania lokalnego (<a href="#eq-1">Równanie&nbsp;<span>6.1</span></a>), gdzie wszystkie dziewięć pikseli w lokalnym otoczeniu 3 × 3 jest dodawanych z identycznymi wagami (1/9). Dzięki temu samemu mechanizmowi można zdefiniować mnóstwo filtrów o różnych właściwościach, modyfikując po prostu rozkład poszczególnych wag.</p>
<p><span id="eq-1"><span class="math display">\[
I'(u,v) = \frac19\sum_{j = -1}^1\sum_{i = -1}^1I(u+i,v+j),
\tag{6.1}\]</span></span></p>
<p>Dla dowolnego filtra liniowego rozmiar i kształt regionu wsparcia (ang. <em>support region</em>), jak również wagi poszczególnych pikseli, są określone przez <em>jądro filtra</em> (ang. <em>kernel</em>) <span class="math inline">\(H(i,j)\)</span>. Rozmiar jądra <span class="math inline">\(H\)</span> równa się rozmiarowi regionu filtrującego, a każdy element <span class="math inline">\((i, j)\)</span> określa wagę odpowiedniego piksela w sumowaniu. Dla filtra wygładzającego 3x3 w równaniu (<a href="#eq-1">Równanie&nbsp;<span>6.1</span></a>), jądro filtra to</p>
<p><span class="math display">\[
H = \begin{bmatrix}
  1/9,&amp;1/9,&amp;1/9\\
  1/9,&amp;1/9,&amp;1/9\\
  1/9,&amp;1/9,&amp;1/9
\end{bmatrix}=
\frac19\begin{bmatrix}
  1,&amp;1,&amp;1\\
  1,&amp;1,&amp;1\\
  1,&amp;1,&amp;1
\end{bmatrix}
\]</span></p>
<p>ponieważ każda z wartości filtra wnosi 1/9 do piksela wynikowego.</p>
<p>W istocie, jądro filtra <span class="math inline">\(H(i, j)\)</span> jest, podobnie jak sam obraz, dyskretną, dwuwymiarową funkcją o rzeczywistą, <span class="math inline">\(H : \mathbb{Z} \times \mathbb{Z} \to \mathbb{R}\)</span>. Filtr ma swój własny układ współrzędnych z początkiem - często określanym jako <em>hot spot</em> - przeważnie (ale niekoniecznie) znajdującym się w środku. Tak więc współrzędne filtra są na ogół dodatnie i ujemne (<a href="#fig-flt2">Rysunek&nbsp;<span>6.2</span></a>). Funkcja filtra ma nieskończony zakres i jest uważana za zerową poza obszarem zdefiniowanym przez macierz <span class="math inline">\(H\)</span>.</p>
<div id="fig-flt2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Zrzut ekranu 2023-02-7 o 21.37.50.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Rysunek&nbsp;6.2: Schemat działania filtru</figcaption><p></p>
</figure>
</div>
<p>Dla filtru liniowego wynik jest jednoznacznie i całkowicie określony przez współczynniki jądra filtru. Zastosowanie filtru do obrazu jest prostym procesem, który został zilustrowany na <a href="#fig-flt2">Rysunek&nbsp;<span>6.2</span></a>. W każdej pozycji obrazu <span class="math inline">\((u, v)\)</span> wykonywane są następujące kroki:</p>
<ol type="1">
<li>Jądro filtra <span class="math inline">\(H\)</span> jest przesuwane nad oryginalnym obrazem <span class="math inline">\(I\)</span> tak, że jego początek <span class="math inline">\(H(0, 0)\)</span> pokrywa się z aktualną pozycją obrazu <span class="math inline">\((u, v)\)</span>.</li>
<li>Wszystkie współczynniki filtra <span class="math inline">\(H(i, j)\)</span> są mnożone z odpowiadającym im elementem obrazu <span class="math inline">\(I(u+i,v+j)\)</span>, a wyniki są sumowane.</li>
<li>Na koniec otrzymana suma jest zapisywana w aktualnej pozycji w nowym obrazie <span class="math inline">\(I'(u, v)\)</span>.</li>
</ol>
<p>Opisując formalnie, wartości pikseli nowego obrazu <span class="math inline">\(I'(u,v)\)</span> są obliczane przez operację</p>
<p><span id="eq-filtr"><span class="math display">\[
I'(u,v) = \sum_{i,j\in R_H}I(u+i, v+j)\cdot H(i,j),
\tag{6.2}\]</span></span></p>
<p>gdzie <span class="math inline">\(R_H\)</span> oznacza zbiór współrzędnych pokrytych przez filtr <span class="math inline">\(H\)</span>. Nie całkiem dla wszystkich współrzędnych, aby być dokładnym. Istnieje oczywisty problem na granicach obrazu, gdzie filtr sięga poza obraz i nie znajduje odpowiadających mu wartości pikseli, które mógłby wykorzystać do obliczenia wyniku. Na razie ignorujemy ten problem granic, ale w dalszej części tego wykładu się tym zajmiemy.</p>
<div id="fig-flt3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/2D_Convolution_Animation.gif" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Rysunek&nbsp;6.3: Ilustracja działania filtru</figcaption><p></p>
</figure>
</div>
<p>Skoro rozumiemy już zasadnicze działanie filtrów i wiemy, że granice wymagają szczególnej uwagi, możemy pójść dalej i zaprogramować prosty filtr liniowy. Zanim jednak to zrobimy, możemy chcieć rozważyć jeszcze jeden szczegół. W operacji punktowej każda nowa wartość piksela zależy tylko od odpowiadającej jej wartości piksela w oryginalnym obrazie, dlatego nie było problemu z zapisaniem wyników z powrotem do tego samego obrazu - obliczenia są wykonywane “w locie” bez potrzeby pośredniego przechowywania. Obliczenia w miejscu nie są generalnie możliwe dla filtra, ponieważ każdy oryginalny piksel przyczynia się do zmiany więcej niż jednego piksela wynikowego i dlatego nie może być zmodyfikowany przed zakończeniem wszystkich operacji.</p>
<p>Potrzebujemy zatem dodatkowego miejsca na przechowywanie obrazu wynikowego, który następnie może być ponownie skopiowany do obrazu źródłowego (jeśli jest to pożądane). Tak więc kompletna operacja filtrowania może być zaimplementowana na dwa różne sposoby (<a href="#fig-flt4">Rysunek&nbsp;<span>6.4</span></a>):</p>
<ol type="A">
<li>Wynik obliczeń filtra jest początkowo zapisywany w nowym obrazie, którego zawartość jest ostatecznie zapisywana z powrotem do obrazu oryginalnego.</li>
<li>Oryginalny obraz jest najpierw kopiowany do obrazu pośredniego, który służy jako źródło dla właściwej operacji filtrowania. Wynik zastępuje piksele w oryginalnym obrazie.</li>
</ol>
<div id="fig-flt4" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Zrzut ekranu 2023-02-7 o 22.10.38.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Rysunek&nbsp;6.4: Dwa schematy implementacji filtrów do obrazów</figcaption><p></p>
</figure>
</div>
<p>Dla obu wersji wymagana jest taka sama ilość pamięci masowej, a więc żadna z nich nie oferuje szczególnej przewagi. W poniższych przykładach używamy na ogół wersji B.</p>
<p>W filtrze prezentowanym powyżej wagi nie muszą być wszystkie takie same. Przykładowo filtr <span class="math inline">\(H(u,v)\)</span> określony następująco</p>
<p><span id="eq-gaussian"><span class="math display">\[
H(u,v)=\begin{bmatrix}
  0.075,&amp;0.125,&amp;0.075\\
  0.125,&amp;0.200,&amp;0.125\\
  0.075,&amp;0.125,&amp;0.075
\end{bmatrix}
\tag{6.3}\]</span></span></p>
<p>również uśrednia wartości w regionie wsparcia filtru ale nadając największe wagi wartościom w środku.</p>
<p>Zauważmy, że wagi filtra <span class="math inline">\(H\)</span> są tak dobrane aby się sumowały do 1. Oznacza to, że filtr ten jest znormalizowany. Normalizacji filtrów używa się po to aby uniknąć sytuacji, w której wartość wyjściowa z filtra byłaby większa niż 255.</p>
<div class="callout callout-style-default callout-tip callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Wskazówka
</div>
</div>
<div class="callout-body-container callout-body">
<p>Ponieważ funkcja <code>plot</code> pakietu <code>imager</code> ma włączoną opcję <code>rescale = TRUE</code> co oznacza, że wartości wynikowe i tak będą przekształcone do przedziału [0,1], to nie unormowane filtry i tak będą wyświetlać poprawnie przefiltrowane obrazy.</p>
</div>
</div>
<div class="cell">
<details><summary>Kod</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/">MASS</a></span><span class="op">)</span></span>
<span><span class="va">filter1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,</span>
<span>                   <span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,</span>
<span>                   <span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, </span>
<span>                  ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">filter1</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]    1    1    1
[2,]    1    1    1
[3,]    1    1    1</code></pre>
</div>
<details><summary>Kod</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">filter2</span> <span class="op">&lt;-</span> <span class="va">filter1</span><span class="op">/</span><span class="fl">9</span></span>
<span><span class="va">filter2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/fractions.html">fractions</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># aby ładnie wyświetlić ułamki</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,] 1/9  1/9  1/9 
[2,] 1/9  1/9  1/9 
[3,] 1/9  1/9  1/9 </code></pre>
</div>
<details><summary>Kod</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># filtry w funkcji convolve muszą być zapisane jako obraz (as.cimg)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/layout.html">layout</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/convolve.html">convolve</a></span><span class="op">(</span><span class="va">boats</span>, <span class="fu"><a href="https://rdrr.io/pkg/imager/man/as.cimg.html">as.cimg</a></span><span class="op">(</span><span class="va">filter1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/convolve.html">convolve</a></span><span class="op">(</span><span class="va">boats</span>, <span class="fu"><a href="https://rdrr.io/pkg/imager/man/as.cimg.html">as.cimg</a></span><span class="op">(</span><span class="va">filter2</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-rescale" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="filters_files/figure-html/fig-rescale-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Rysunek&nbsp;6.5: Przykład użycia filtra przed i po normalizacji</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details><summary>Kod</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/convolve.html">convolve</a></span><span class="op">(</span><span class="va">boats</span>, <span class="fu"><a href="https://rdrr.io/pkg/imager/man/as.cimg.html">as.cimg</a></span><span class="op">(</span><span class="va">filter1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>rescale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Error in colourscale(v[[1]], v[[2]], v[[3]]) : 
  color intensity 1.57913, not in [0,1]</code></pre>
</div>
</div>
<p>Zatem możemy w konstruowaniu filtrów stosować wartości całkowite i wspólnej wartości normalizacyjnej.</p>
<p><span class="math display">\[
H(u,v)=\begin{bmatrix}
  0.075,&amp;0.125,&amp;0.075\\
  0.125,&amp;0.200,&amp;0.125\\
  0.075,&amp;0.125,&amp;0.075
\end{bmatrix}=
\frac1{40}\cdot
\begin{bmatrix}
  3,&amp;5,&amp;3\\
  5,&amp;8,&amp;5\\
  3,&amp;5,&amp;3
\end{bmatrix}.
\]</span></p>
<p>Aby uniknąć wartości ujemnych, które mogłyby się pojawić w przypadku gdy jądro filtra zawierałoby wartości ujemne, stosuje się stałą przesunięcia (ang. <em>offset</em>). Wówczas <a href="#eq-filtr">Równanie&nbsp;<span>6.2</span></a> przyjmuje postać</p>
<p><span class="math display">\[
I'(u,v) = Offset+\frac{1}{Scale}\cdot \sum_{i,j\in R_H}I(u+i, v+j)\cdot H(i,j),
\]</span></p>
<p>a <span class="math inline">\(H(i,j)\)</span> jest zdefiniowany na <span class="math inline">\(\mathbb{Z}\times\mathbb{Z}\)</span>. Chociaż najczęściej używa się filtrów kwadratowych, to nie ma przeszkód aby stosować również filtry prostokątne. Powyższa formuła ma zastosowanie do filtrów o dowolnym rozmiarze i kształcie.</p>
<section id="przykładowe-filtry-wygładzające-ang.-smoothing" class="level3" data-number="6.1.1"><h3 data-number="6.1.1" class="anchored" data-anchor-id="przykładowe-filtry-wygładzające-ang.-smoothing">
<span class="header-section-number">6.1.1</span> Przykładowe filtry wygładzające (ang. <em>smoothing</em>)</h3>
<ol type="1">
<li><p>Filtr pudełkowy (ang <em>box</em>), którego zasada działania została już przedstawiona w <a href="#eq-1">Równanie&nbsp;<span>6.1</span></a> dla rozmiaru filtra 3x3 jest jednym z filtrów wygładzających. Im większy jest rozmiar filtra, tym większy stopień wygładzenia obrazu wyjściowego. Ten najprostszy ze wszystkich filtrów wygładzających, którego kształt 3D przypomina pudełko (<a href="#fig-flt5">Rysunek&nbsp;<span>6.6</span></a> (a)), jest dobrze znany. Niestety, filtr pudełkowy jest daleki od optymalnego filtra wygładzającego ze względu na swoje dziwne zachowanie w przestrzeni częstotliwości, które jest spowodowane ostrym odcięciem wokół jego boków. Opisane w kategoriach częstotliwościowych wygładzanie odpowiada tzw. filtracji dolnoprzepustowej, czyli efektywnemu tłumieniu wszystkich składowych sygnału powyżej danej częstotliwości odcięcia. Filtr pudełkowy wytwarza jednak silne “dzwonienie” w przestrzeni częstotliwości i dlatego nie jest uważany za wysokiej jakości filtr wygładzający. Przypisanie tej samej wagi wszystkim pikselom obrazu w regionie filtru może też wydawać się dość doraźne. Zamiast tego należałoby prawdopodobnie oczekiwać, że silniejszy nacisk zostanie położony na piksele znajdujące się w pobliżu centrum filtra niż na te bardziej odległe. Ponadto filtry wygładzające powinny ewentualnie działać “izotropowo” (tzn. jednolicie w każdym kierunku), co z pewnością nie ma miejsca w przypadku filtra prostokątnego.</p></li>
<li><p>Filtr gaussowski - z pewnością lepszy w tym kontekście wygładzania z względu na brak ostrych krawędzi jądra. Definiuje się go następująco <span class="math display">\[
H^{G,\sigma}(x,y) = e^{-\frac{x^2+y^2}{2\sigma^2}},
\]</span> gdzie <span class="math inline">\(\sigma\)</span> oznacza odchylenie standardowe rozkładu.</p></li>
</ol></section><section id="przykład-filtru-różnicującego" class="level3" data-number="6.1.2"><h3 data-number="6.1.2" class="anchored" data-anchor-id="przykład-filtru-różnicującego">
<span class="header-section-number">6.1.2</span> Przykład filtru różnicującego</h3>
<p>Jeśli niektóre współczynniki filtra są ujemne, to obliczenie filtra można zinterpretować jako różnicę dwóch sum: suma ważona wszystkich pikseli z przypisanymi współczynnikami dodatnimi minus suma ważona pikseli z ujemnymi współczynnikami w regionie filtra RH , czyli</p>
<p><span id="eq-gauss2"><span class="math display">\[
\begin{align}
  I'(u,v)=&amp;\sum_{(i,j)\in R^+}I(u+i, v+j)\cdot \vert H(i,j)\vert -\\
-&amp;\sum_{(i,j)\in R^-}I(u+i, v+j)\cdot \vert H(i,j)\vert,
\end{align}
\tag{6.4}\]</span></span></p>
<p>gdzie <span class="math inline">\(R^-, R^+\)</span> oznaczają podział filtra na współczynniki ujemne <span class="math inline">\(H(i,j)&lt;0\)</span> i dodatnie <span class="math inline">\(H(i,j)&gt;0\)</span> odpowiednio. Na przykład filtr Laplace’a 5x5 na <a href="#fig-flt5">Rysunek&nbsp;<span>6.6</span></a> (c) oblicza różnicę między pikselem środkowym (o wadze 16) a sumą ważoną 12 otaczających go pikseli (o wagach -1 lub -2). Pozostałe 12 pikseli ma przypisane zerowe współczynniki i dlatego są one ignorowane w obliczeniach. Podczas gdy lokalne zmiany intensywności są wygładzane przez uśrednianie, możemy oczekiwać, że w przypadku różnic stanie się dokładnie odwrotnie - lokalne zmiany intensywności zostaną wzmocnione.</p>
<div id="fig-flt5" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Zrzut ekranu 2023-02-7 o 23.46.00.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Rysunek&nbsp;6.6: Przykłady różnych filtrów o rozmiarze 5x5. (a) filtr pudełkowy, (b) gaussowski, (c) Laplace’a (zwany także <em>Mexican Hut</em>)</figcaption><p></p>
</figure>
</div>
</section><section id="formalny-zapis-operatorów-filtracji" class="level3" data-number="6.1.3"><h3 data-number="6.1.3" class="anchored" data-anchor-id="formalny-zapis-operatorów-filtracji">
<span class="header-section-number">6.1.3</span> Formalny zapis operatorów filtracji</h3>
<p>Wspomniany zapis w równaniu <a href="#eq-filtr">Równanie&nbsp;<span>6.2</span></a> nazywany jest w literaturze operatorem korelacyjnym (ang. <em>correlation operator)</em>. Ma on jedną poważną wadę, ponieważ filtr zastosowany do obrazu z pojedynczym wtrąceniem (jednym pikselem świecącym) w rezultacie daje w obrazie wynikowym wartości filtra zrotowane o <span class="math inline">\(180\degree\)</span> (patrz <a href="#fig-corr">Rysunek&nbsp;<span>6.7</span></a>).</p>
<div id="fig-corr" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Zrzut ekranu 2023-02-8 o 18.44.52.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Rysunek&nbsp;6.7: Zastosowanie operatora korelacyjnego na obrazie z jednym wtrąceniem</figcaption><p></p>
</figure>
</div>
<p>Rozwiązaniem tej niedogodności jest wprowadzenie operatora konwolucyjnego (ang. <em>convolution operator</em>). Definiuje się go w następujący sposób:</p>
<p><span id="eq-conv"><span class="math display">\[
I'(u,v) = \sum_{i,j\in R_H}I(u-i, v-j)\cdot H(i,j),
\tag{6.5}\]</span></span></p>
<p>zapisywany również w bardziej zwartej formie</p>
<p><span id="eq-conv2"><span class="math display">\[
I'=I*H.
\tag{6.6}\]</span></span></p>
<p>Aby pokazać związek pomiędzy oboma sposobami filtracji przekształćmy wzór <a href="#eq-conv">Równanie&nbsp;<span>6.5</span></a></p>
<p><span id="eq-convcorr"><span class="math display">\[
\begin{align}
  I'(u,v) =&amp; \sum_{i,j\in R_H}I(u-i, v-j)\cdot H(i,j)=\\
  =&amp;\sum_{i,j\in R_H}I(u+i, v+j)\cdot H(-i,-j)=\\
  =&amp;\sum_{i,j\in R_H}I(u+i, v+j)\cdot H^*(i,j),
\end{align}
\tag{6.7}\]</span></span></p>
<p>gdzie <span class="math inline">\(H^*(i,j)=H(-i,-j)\)</span>. Zmiana parametryzacji powoduje obrócenie wyniku o <span class="math inline">\(180\degree\)</span>.</p>
<div id="fig-conv3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Zrzut ekranu 2023-02-8 o 18.45.03.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Rysunek&nbsp;6.8: Zastosowanie operatora konwolucyjnego do obrazu z jednym wtrąceniem</figcaption><p></p>
</figure>
</div>
</section><section id="własności-filtrów-liniowych" class="level3" data-number="6.1.4"><h3 data-number="6.1.4" class="anchored" data-anchor-id="własności-filtrów-liniowych">
<span class="header-section-number">6.1.4</span> Własności filtrów liniowych</h3>
<p>Konwolucja liniowa jest odpowiednim modelem dla wielu rodzajów zjawisk naturalnych, w tym układów mechanicznych, akustycznych i optycznych. W szczególności istnieją silne formalne powiązania z reprezentacją Fouriera sygnałów w dziedzinie częstotliwości, które są niezwykle cenne dla zrozumienia złożonych zjawisk, takich jak próbkowanie i aliasing. Poniżej przedstawione zostaną własności konwolucji liniowej.</p>
<section id="przemienność" class="level4" data-number="6.1.4.1"><h4 data-number="6.1.4.1" class="anchored" data-anchor-id="przemienność">
<span class="header-section-number">6.1.4.1</span> Przemienność</h4>
<p>Konwolucja liniowa jest przemienna, czyli dla dowolnego obrazu <span class="math inline">\(I\)</span> i jądra filtru <span class="math inline">\(H\)</span>, zachodzi</p>
<p><span id="eq-przemiennosc"><span class="math display">\[
I ∗ H = H ∗ I.
\tag{6.8}\]</span></span></p>
<p>Wynik jest więc taki sam, jeśli obraz i jądro filtra są wzajemnie zamienione, i nie ma różnicy, czy składamy obraz <span class="math inline">\(I\)</span> z jądrem <span class="math inline">\(H\)</span>, czy odwrotnie.</p>
</section><section id="liniowość" class="level4" data-number="6.1.4.2"><h4 data-number="6.1.4.2" class="anchored" data-anchor-id="liniowość">
<span class="header-section-number">6.1.4.2</span> Liniowość</h4>
<p>Filtry liniowe nazywane są tak ze względu na właściwości liniowości operacji konwolucji, która przejawia się w różnych aspektach. Na przykład, jeśli obraz jest mnożony przez skalar <span class="math inline">\(s\in\mathbb{R},\)</span> to wynik konwolucji mnoży się o ten sam czynnik, czyli</p>
<p><span id="eq-liniowosc1"><span class="math display">\[
(s\cdot I)∗H = I ∗(s\cdot H) = s\cdot(I ∗H).
\tag{6.9}\]</span></span></p>
<p>Podobnie, jeśli dodamy dwa obrazy <span class="math inline">\(I_1\)</span>, <span class="math inline">\(I_2\)</span> piksel po pikselu i spleciemy wynikowy obraz za pomocą pewnego jądra <span class="math inline">\(H\)</span>, to taki sam wynik uzyskamy splatając każdy obraz osobno i dodając potem oba wyniki, czyli</p>
<p><span id="eq-liniowosc2"><span class="math display">\[
(I_1 +I_2)∗H = (I_1 ∗H)+(I_2 ∗H).
\tag{6.10}\]</span></span></p>
<p>Zaskakujące może być jednak to, że samo dodanie do obrazu stałej wartości <span class="math inline">\(b\)</span> nie powiększa wyniku splotu o taką samą ilość,</p>
<p><span class="math display">\[
(b+I)∗H\neq b+(I∗H),
\]</span></p>
<p>a więc nie jest częścią własności liniowości. Chociaż liniowość jest ważną własnością teoretyczną, należy zauważyć, że w praktyce filtry “liniowe” są często tylko częściowo liniowe z powodu błędów zaokrąglenia lub ograniczonego zakresu wartości wyjściowych.</p>
</section><section id="łączność" class="level4" data-number="6.1.4.3"><h4 data-number="6.1.4.3" class="anchored" data-anchor-id="łączność">
<span class="header-section-number">6.1.4.3</span> Łączność</h4>
<p>Konwolucja liniowa jest łączna, co oznacza, że kolejność operacji na filtrze nie ma znaczenia, czyli,</p>
<p><span id="eq-lacznosc"><span class="math display">\[
(I∗H_1)∗H_2 =I∗(H_1 ∗H_2).
\tag{6.11}\]</span></span></p>
<p>Tak więc wiele filtrów może być zastosowanych w dowolnej kolejności, jak również wiele filtrów może być dowolnie łączonych w nowe filtry.</p>
<p>Bezpośrednią konsekwencją łączności jest rozdzielność filtrów liniowych. Jeżeli jądro konwolucyjne <span class="math inline">\(H\)</span> można wyrazić jako złożenie wielu jąder <span class="math inline">\(H_i\)</span> w postaci</p>
<p><span id="eq-rozlacznosc"><span class="math display">\[
H = H1 ∗ H2 ∗ . . . ∗ Hn,
\tag{6.12}\]</span></span></p>
<p>wówczas (jako konsekwencja <a href="#eq-lacznosc">Równanie&nbsp;<span>6.11</span></a>) operacja filtru <span class="math inline">\(I ∗ H\)</span> może być wykonana jako ciąg konwolucji z jądrami składowymi <span class="math inline">\(H_i,\)</span></p>
<p><span id="eq-lacznosc2"><span class="math display">\[
I ∗ H = I ∗ (H_1 ∗ H_2 ∗ . . . ∗ H_n)
= (\ldots((I ∗H_1)∗H_2)∗\ldots∗H_n).
\tag{6.13}\]</span></span></p>
<p>W zależności od rodzaju dekompozycji może to przynieść znaczne oszczędności obliczeniowe. O rozdzielczości filtrów możemy myśleć również nieco inaczej</p>
<p><span class="math display">\[
I'=(I*h_x)*h_y,
\]</span> gdzie <span class="math inline">\(h_x, h_y\)</span> są filtrami 1D, które po wymnożeniu tworzą filtr o wymiarze <span class="math inline">\(k\times m\)</span>. Przykładowo</p>
<p><span id="eq-mnozenie"><span class="math display">\[
\begin{bmatrix}
  1,&amp;1,&amp;1,&amp;1,&amp;1\\
  1,&amp;1,&amp;1,&amp;1,&amp;1\\
  1,&amp;1,&amp;1,&amp;1,&amp;1
\end{bmatrix}
= H = h_x*h_y=
\begin{bmatrix}
  1\\
  1\\
  1
\end{bmatrix}
\cdot
    \begin{bmatrix}
        1,&amp;1,&amp;1,&amp;1,&amp;1
       \end{bmatrix}
\tag{6.14}\]</span></span></p>
<p>Stosując tą własność rozłączności możemy również przedstawić filtr o jądrze gassuowskim 2D, za pomocą mnożenia filtrów gaussowskich 1D.</p>
<p><span id="eq-mnozenie2"><span class="math display">\[
H^{G,\sigma}=h^{G,\sigma}_x*h^{G,\sigma}_y,
\tag{6.15}\]</span></span></p>
<p>gdzie <span class="math inline">\(h^{G,\sigma}_x,h^{G,\sigma}_y\)</span> są filtrami gaussowskimi 1D. Kolejność użytych filtrów ponownie nie ma znaczenia. Jeśli dla poszczególnych składowych odchylenia standardowe nie są równe, to filtr gaussowski 2D ma charakter eliptyczny.</p>
<p>W algebrze filtrów liniowych istniej coś na kształt elementu neutralnego dla operacji splotu</p>
<p><span id="eq-dirac"><span class="math display">\[
I = \delta*I,
\tag{6.16}\]</span></span></p>
<p>gdzie</p>
<p><span id="eq-dirac2"><span class="math display">\[
\delta(u,v)=
\begin{cases}
  1, &amp;\text{ jeśli }u=v=0\\
  0, &amp;\text{ w przeciwnym przypadku}
\end{cases}
\tag{6.17}\]</span></span></p>
<p>Co ciekawe filtr ten nie zmienia jedynie samego obrazu ale również innych filtrów</p>
<p><span id="eq-dirac3"><span class="math display">\[
H=\delta*H=H*\delta.
\tag{6.18}\]</span></span></p>
</section></section></section><section id="filtry-nieliniowe" class="level2" data-number="6.2"><h2 data-number="6.2" class="anchored" data-anchor-id="filtry-nieliniowe">
<span class="header-section-number">6.2</span> Filtry nieliniowe</h2>
<section id="filtry-minimum-i-maksimum" class="level3" data-number="6.2.1"><h3 data-number="6.2.1" class="anchored" data-anchor-id="filtry-minimum-i-maksimum">
<span class="header-section-number">6.2.1</span> Filtry minimum i maksimum</h3>
<p>Jak wszystkie inne filtry, filtry nieliniowe obliczają wynik w danej pozycji obrazu <span class="math inline">\((u,v)\)</span> z pikseli znajdujących się wewnątrz ruchomego regionu <span class="math inline">\(R_{u,v}\)</span> oryginalnego obrazu. Filtry te nazywane są “nieliniowymi”, ponieważ wartości pikseli źródłowych są łączone przez jakąś funkcję nieliniową. Najprostszymi ze wszystkich filtrów nieliniowych są filtry minimum i maksimum, zdefiniowane jako</p>
<p><span id="eq-minmax"><span class="math display">\[
\begin{align}
  I'(u,v)=&amp;\min_{(i,j)\in R}\{I(u+i, v+j)\}\\
  I'(u,v)=&amp;\max_{(i,j)\in R}\{I(u+i, v+j)\}
\end{align}
\tag{6.19}\]</span></span></p>
<p>gdzie <span class="math inline">\(R\)</span> oznacza region filtra (zbiór współrzędnych filtra, zwykle kwadrat o rozmiarach 3x3 pikseli). <a href="#fig-min">Rysunek&nbsp;<span>6.10</span></a> ilustruje wpływ minimalnego filtra 1D na różne lokalne struktury sygnału.</p>
<div id="fig-min" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Zrzut ekranu 2023-02-8 o 19.52.39.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Rysunek&nbsp;6.9: Zastosowanie filtru minimum 1D do różnych sygnałów wejściowych. Górny rząd przedstawia oryginalny sygnał, a dolny spleciony z filtrem minimum</figcaption><p></p>
</figure>
</div>
<div class="cell" data-hash="filters_cache/html/fig-min_d7bb2711bfe570e432e18daef18beeab">
<details><summary>Kod</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">kwiat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/imager/man/load.image.html">load.image</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"~/kwiat.jpg"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/imager/man/grayscale.html">grayscale</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">min_filter</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">im</span>, <span class="va">radius</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">stencil</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>dx <span class="op">=</span> <span class="op">-</span><span class="va">radius</span><span class="op">:</span><span class="va">radius</span>, dy <span class="op">=</span> <span class="op">-</span><span class="va">radius</span><span class="op">:</span><span class="va">radius</span><span class="op">)</span></span>
<span>  <span class="va">filtered</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/imager/man/cimg.dimensions.html">height</a></span><span class="op">(</span><span class="va">im</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/imager/man/cimg.dimensions.html">width</a></span><span class="op">(</span><span class="va">im</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">range_x</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">radius</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/imager/man/cimg.dimensions.html">width</a></span><span class="op">(</span><span class="va">im</span><span class="op">)</span> <span class="op">-</span> <span class="va">radius</span><span class="op">)</span></span>
<span>  <span class="va">range_y</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">radius</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/imager/man/cimg.dimensions.html">height</a></span><span class="op">(</span><span class="va">im</span><span class="op">)</span> <span class="op">-</span> <span class="va">radius</span><span class="op">)</span></span>
<span>  <span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span><span class="va">range_x</span>, <span class="va">range_y</span><span class="op">)</span></span>
<span>  <span class="va">dt</span><span class="op">$</span><span class="va">min</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">dt</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">row</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/imager/man/get.stencil.html">get.stencil</a></span><span class="op">(</span><span class="va">im</span>, </span>
<span>                                                       <span class="va">stencil</span>, </span>
<span>                                                       x <span class="op">=</span> <span class="va">row</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                                                       y <span class="op">=</span> <span class="va">row</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">filtered</span> <span class="op">&lt;-</span> <span class="va">dt</span><span class="op">$</span><span class="va">min</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/imager/man/cimg.dimensions.html">height</a></span><span class="op">(</span><span class="va">im</span><span class="op">)</span><span class="op">-</span><span class="fl">2</span><span class="op">*</span><span class="va">radius</span>,</span>
<span>           nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/imager/man/cimg.dimensions.html">width</a></span><span class="op">(</span><span class="va">im</span><span class="op">)</span><span class="op">-</span><span class="fl">2</span><span class="op">*</span><span class="va">radius</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/imager/man/as.cimg.html">as.cimg</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">filtered</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">kwiat_filtered</span> <span class="op">&lt;-</span> <span class="fu">min_filter</span><span class="op">(</span><span class="va">kwiat</span>, radius <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/layout.html">layout</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">kwiat</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>main <span class="op">=</span> <span class="st">'oryginał'</span><span class="op">)</span></span>
<span><span class="va">kwiat_filtered</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>main <span class="op">=</span> <span class="st">"filtr minimum"</span><span class="op">)</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-min" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="filters_files/figure-html/fig-min-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Rysunek&nbsp;6.10: Zastosowanie filtru minimum</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>W przypadku obrazów z wtrąceniami w kolorze białym lub czarnym efekt występowania tych wtrąceń jest potęgowany (patrz <a href="#fig-minmax2">Rysunek&nbsp;<span>6.11</span></a>). Filtr minimum wyciąga kolor czarny, natomiast filtr maksimum kolor biały.</p>
<div>
<details><summary>Kod</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">kwiat_noisy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/imager/man/load.image.html">load.image</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"~/kwiat_salt_pepper.jpg"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/imager/man/grayscale.html">grayscale</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">kwiat_noisy</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">kwiat_noisy</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/imager/man/erode.html">erode_square</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">kwiat_noisy</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/imager/man/erode.html">dilate_square</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="fig-minmax2" class="cell quarto-layout-panel">
<figure class="figure"><div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 33.3%;justify-content: center;">
<div id="fig-minmax2-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="filters_files/figure-html/fig-minmax2-1.png" class="img-fluid figure-img" data-ref-parent="fig-minmax2" width="672"></p>
<p></p><figcaption class="figure-caption">(a) Oryginał</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 33.3%;justify-content: center;">
<div id="fig-minmax2-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="filters_files/figure-html/fig-minmax2-2.png" class="img-fluid figure-img" data-ref-parent="fig-minmax2" width="672"></p>
<p></p><figcaption class="figure-caption">(b) Filtr minimum</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 33.3%;justify-content: center;">
<div id="fig-minmax2-3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="filters_files/figure-html/fig-minmax2-3.png" class="img-fluid figure-img" data-ref-parent="fig-minmax2" width="672"></p>
<p></p><figcaption class="figure-caption">(c) Filtr maximum</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Rysunek&nbsp;6.11: Porównanie trzech obrazów</figcaption><p></p>
</figure>
</div>
</div>
</section><section id="filtr-medianowy" class="level3" data-number="6.2.2"><h3 data-number="6.2.2" class="anchored" data-anchor-id="filtr-medianowy">
<span class="header-section-number">6.2.2</span> Filtr medianowy</h3>
<p>Nie da się oczywiście zaprojektować filtra, który usunie każdy szum i zachowa wszystkie ważne struktury obrazu, ponieważ żaden filtr nie jest w stanie rozróżnić, która zawartość obrazu jest ważna dla widza, a która nie. Popularny filtr medianowy jest z pewnością dobrym krokiem w tym kierunku.</p>
<p>Filtr medianowy zastępuje każdy piksel obrazu medianą pikseli w bieżącym regionie filtra <span class="math inline">\(R\)</span>, czyli</p>
<p><span id="eq-median"><span class="math display">\[
I'(u,v)=\operatorname{Median}_{(i,j)\in R}\{I(u+i, v+j)\}.
\tag{6.20}\]</span></span></p>
<div id="fig-median" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Zrzut ekranu 2023-02-9 o 18.29.37.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Rysunek&nbsp;6.12: Zasada działania filtra medianowego</figcaption><p></p>
</figure>
</div>
<p>Równanie (<a href="#eq-median">Równanie&nbsp;<span>6.20</span></a>) definiuje medianę zbioru wartości o nieparzystej liczebności. Jeśli długość boku filtrów prostokątnych jest nieparzysta (co zwykle ma miejsce), to liczba elementów w regionie filtrów również jest nieparzysta. W takim przypadku filtr medianowy nie tworzy żadnych nowych wartości pikseli. Jeśli jednak liczba elementów jest parzysta, to mediana posortowanego ciągu <span class="math inline">\(A = (a_0,\ldots,a_{2n-1})\)</span> jest definiowana jako średnia arytmetyczna dwóch sąsiednich wartości środkowych <span class="math inline">\(a_{n-1}\)</span> i <span class="math inline">\(a_n\)</span>. W ten sposób mogą być wprowadzone nowe wartości do obrazu.</p>
<div class="cell">
<details><summary>Kod</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">box_flt</span> <span class="op">&lt;-</span> <span class="va">kwiat_noisy</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/imager/man/boxblur.html">boxblur</a></span><span class="op">(</span>boxsize <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">median_flt</span> <span class="op">&lt;-</span> <span class="va">kwiat_noisy</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/imager/man/medianblur.html">medianblur</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">kwiat_noisy</span>, <span class="va">box_flt</span>, <span class="va">median_flt</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/imager/man/imappend.html">imappend</a></span><span class="op">(</span><span class="st">"x"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-median2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="filters_files/figure-html/fig-median2-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Rysunek&nbsp;6.13: Porównanie metod usuwania szumu. Na obrazie po lewej stronie naniesiony jest szum (znany jako <em>salt and papper</em>). Na środkowym szum jest usuwany filtrem pudełkowym (ang. <em>box filter</em>). Na obrazie po prawej szum jest usuwany filtrem medianowym.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details><summary>Kod</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">box_flt_big</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/imager/man/imsub.html">imsub</a></span><span class="op">(</span><span class="va">box_flt</span>, <span class="va">x</span> <span class="op"><a href="https://rdrr.io/pkg/imager/man/grapes-inr-grapes.html">%inr%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">450</span><span class="op">)</span>, <span class="va">y</span> <span class="op"><a href="https://rdrr.io/pkg/imager/man/grapes-inr-grapes.html">%inr%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">300</span>, <span class="fl">550</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">median_flt_big</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/imager/man/imsub.html">imsub</a></span><span class="op">(</span><span class="va">median_flt</span>, <span class="va">x</span> <span class="op"><a href="https://rdrr.io/pkg/imager/man/grapes-inr-grapes.html">%inr%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">450</span><span class="op">)</span>, <span class="va">y</span> <span class="op"><a href="https://rdrr.io/pkg/imager/man/grapes-inr-grapes.html">%inr%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">300</span>, <span class="fl">550</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/pkg/imager/man/imappend.html">imappend</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">box_flt_big</span>, <span class="va">median_flt_big</span><span class="op">)</span>, <span class="st">"x"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Kopiuj do schowka" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-median3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="filters_files/figure-html/fig-median3-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Rysunek&nbsp;6.14: W powiększeniu ten efekt jest jeszcze lepiej widoczny</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Mediana jest statystyką porządkową i w pewnym sensie “większość” uwzględnianych wartości pikseli określa wynik. Pojedyncza wyjątkowo wysoka lub niska wartość (“odstająca”) nie może wpłynąć na wynik, a jedynie przesunąć go w górę lub w dół do następnej wartości. Dlatego mediana (w przeciwieństwie do średniej) jest uważana za miarę “odporną”. W zwykłym filtrze medianowym każdy piksel w regionie filtra ma taki sam wpływ, niezależnie od jego odległości od środka.</p>
</section></section><section id="obramowania-obrazów" class="level2" data-number="6.3"><h2 data-number="6.3" class="anchored" data-anchor-id="obramowania-obrazów">
<span class="header-section-number">6.3</span> Obramowania obrazów</h2>
<p>Jak to zostało zaznaczone wcześniej zastosowanie jakiegokolwiek filtru (liniowego lub nieliniowego) wiąże się z pewna niedogodnością. Mianowicie wszystkie filtry kwadratowe czy prostokątne są kłopotliwe w zastosowaniu jeśli centrum (<em>hot spot</em>) filtra leży blisko brzegu obrazu. Teoretycznie filtry nie mogą być stosowane w miejscach, gdzie macierz filtrów nie jest w pełni zawarta w macierzy obrazu. Zatem każda operacja filtrująca zmniejszyłaby rozmiar obrazu wynikowego, co w większości zastosowań jest nie do przyjęcia. Choć nie istnieje formalnie poprawne remedium, istnieje kilka mniej lub bardziej praktycznych metod obsługi regionów granicznych:</p>
<ol type="1">
<li>Ustaw nieprzetworzone piksele na granicach na jakąś stałą wartość (np. “czarny”). Jest to z pewnością najprostsza metoda, ale w wielu sytuacjach nie do przyjęcia, ponieważ rozmiar obrazu jest stopniowo zmniejszany przez każdą operację filtra.</li>
<li>Ustaw nieprzetworzone piksele na oryginalne (niefiltrowane) wartości obrazu. Zazwyczaj wyniki są również nie do przyjęcia, ze względu na zauważalną różnicę między przefiltrowanymi i nieprzetworzonymi fragmentami obrazu.</li>
<li>Rozwiń obraz, “wypełniając” (ang. <em>padding</em>) dodatkowe piksele wokół niego i zastosuj filtr również do regionów granicznych. Na <a href="#fig-border">Rysunek&nbsp;<span>6.15</span></a> pokazano różne opcje wypełniania obrazów (obraz (a) jest oryginałem).
<ol type="1">
<li><p>Piksele poza obrazem mają stałą wartość (np. “czarny” lub “szary”, patrz <a href="#fig-border">Rysunek&nbsp;<span>6.15</span></a> (b)). Może to powodować silne artefakty na granicach obrazu, szczególnie w przypadku stosowania dużych filtrów.</p></li>
<li><p>Piksele graniczne wykraczają poza granice obrazu (<a href="#fig-border">Rysunek&nbsp;<span>6.15</span></a> (c)). W miejscach występowania granic można spodziewać się jedynie niewielkich artefaktów. Metoda ta jest również prosta obliczeniowo i dlatego często jest uważana za najlepszy wybór.</p></li>
<li><p>Obraz jest odbijany na każdej ze swoich czterech granic (<a href="#fig-border">Rysunek&nbsp;<span>6.15</span></a> (d)). Wyniki będą podobne jak w przypadku poprzedniej metody, o ile nie zostaną użyte bardzo duże filtry.</p></li>
<li><p>Obraz powtarza się cyklicznie w kierunku poziomym i pionowym (<a href="#fig-border">Rysunek&nbsp;<span>6.15</span></a> (e)). Może się to początkowo wydawać dziwne, a wyniki na ogół nie są zadowalające. Jednak w dyskretnej analizie spektralnej obraz jest pośrednio traktowany również jako funkcja okresowa. Jeśli więc obraz jest filtrowany w dziedzinie częstotliwości, to wyniki będą równe filtracji w dziedzinie przestrzeni w ramach tego powtarzalnego modelu.</p></li>
</ol>
</li>
</ol>
<div id="fig-border" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="images/Zrzut ekranu 2023-02-9 o 19.28.41.png" class="img-fluid figure-img" width="600"></p>
<p></p><figcaption class="figure-caption">Rysunek&nbsp;6.15: Różne sposoby obsługi obramowania</figcaption><p></p>
</figure>
</div>
<p>Żadna z tych metod nie jest doskonała i zwykle, właściwy wybór zależy od rodzaju obrazu i zastosowanego filtra.</p>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Skopiowano!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Skopiowano!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./point_trans.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Transformacje punktowe</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./edge.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Wykrywanie krawędzi i konturów</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">Automatyczna analiza obrazu, Dariusz Majerek</div>   
    <div class="nav-footer-right">Książka została napisana w <a href="https://quarto.org/">Quarto</a></div>
  </div>
</footer>


</body></html>